server {
    listen 80;
    server_name localhost;

    # ===============================
    # 1. Frontend (Vue 빌드 파일 서빙)
    # ===============================
    location / {
        root /usr/share/nginx/html;
        index index.html;
        try_files $uri $uri/ /index.html;
    }

    # ===============================
    # 2. Backend API 프록시 (CORS 제거)
    # ===============================
    location /api {
        # [찰스 수정] Nginx에서 CORS 헤더를 직접 추가하지 마십시오!
        # 백엔드(Spring Boot)가 이미 올바른 헤더를 내려주고 있습니다.
        # 여기서 또 추가하면 '중복 헤더 에러'가 발생합니다.

        # 실제 API 요청을 백엔드 컨테이너로 전달
        # (docker-compose 서비스명이 'backend'라고 가정)
        proxy_pass http://backend:8080;

        # 호스트 정보 전달 (중요)
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # (선택 사항) 웹소켓 사용 시 필요
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }
}